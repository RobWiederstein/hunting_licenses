---
title: "Hunting As United States Pastime 1960 to 2020:  Implications for Conservation"
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
author: "Robert Wiederstein"
date: "11/14/2020"
new_session: true
output:
  bookdown::html_document2:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: true
    theme: readable
    highlight: pygments
    fig_caption: true
bibliography: references.bib
nocite: '@*'
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# https://learnui.design/tools/data-color-picker.html#palette
my.palettes <- list(qualitative = c("#4582ec", "#c86edb", "#ff5ca4", "#ff745c", "#ffa600"),
                     sequential = c("#4582ec", "#7499f1", "#98b0f6", "#b9c8fb", "#d9e1ff"),
                     diverging = c("#4582ec",  "#8da5ef", "#c2caf0", "#f1f1f1", "#f0b8b8",
                                   "#e67f83", "#d43d51")
                     )
```

```{r load_file, include=FALSE}
load_main_dataframe <- function(){
      source("./R/00_main.R")
      source("./R/functions.R")
      file <- "./data_tidy/hunting_licenses_by_state_1960_and_2020.csv"
      colClasses <- c(rep("character", 3), "integer", "character", "numeric")
      df.00 <- data.table::fread(file = file, data.table = F, colClasses = colClasses)
      df.00
}
df.00 <- load_main_dataframe()
```

```{r load_libraries, include = FALSE}
my.libraries <- list(packages = c("ggplot2", "magrittr", "ggthemes", "flextable", "officer", "knitr", "kableExtra", "sparkline", "ggmap", "rgdal", "rgeos", "maptools", "dplyr", "tidyr", "tmap"))
lapply(my.libraries$packages, library, character.only = TRUE, quietly = TRUE)
#set options
options(knitr.table.format = "html") 

```

# Question

Hunting as a pastime is declining in the United States.^[The views, analysis and conclusions presented within this paper represent the author's alone and not of any other person, organization or government entity. While I have made every reasonable effort to ensure that the information in this article was correct, it will nonetheless contain errors, inaccuracies and inconsistencies.  It is a working paper subject to revision without notice as additional information becomes available. Any liability is disclaimd as to any party for any loss, damage, or disruption caused by errors or omissions, whether such errors or omissions result from negligence, accident, or any other cause. The author(s) received no financial support for the research, authorship, and/or publication of this article.] Its prolonged slump and projected decline is significant because license fees and taxes fund wildlife conservation efforts.   This "user-play, user-pay" funding system--a model replicated across the globe--is jeopardizing conservation efforts as hunting declines.  [@rottDeclineHuntersThreatens2018]Recent legislative proposal at the federal level have attempted to diversify funding sources in response.  The question for consideration is whether hunting  declined from 1960 to 2020, how much agreement exists between available data sources, and which states have been impacted.

# Background

Hunting is a significant source of entertainment, excercise, camraderie, and nourishment for many Americans, especially those living in rural locations where leisure opportunities are scarce and wildlife more prevalent.  Every five years the National Survey of Fishing, Hunting and Wildlife Associated Recreation is conducted by the U.S. Fish and Wildlife and the U.S. Census.  The last survey in 2016 found that "11.5 million people 16 years and older enjoyed hunting a variety of animals within the United States. They hunted 184 million days and took 147 million trips. Hunting expenditures totaled $26.2 billion."  [@uscensusbureau2016FHWARNational2016] The survey reported that the national participation rate was four percent with significant regional variation. For example, the New England region had a two percent participation rate while the East South Central region had an eight percent participation rate. [@uscensusbureau2016FHWARNational2016] Given its popularity and economic impact, hunting is rightfully the subject of intense study.

## Wildlife as Public Resource

Wildlife is a public resource and should be managed prudently.  The Public Trust Doctrine (PTD) is considered to be the cornerstone of the North American Model of Wildlife Conservation (AMWC). The doctrine posits that "wildlife is owned by no one and held in trust by governments for the present and future benefit of its citizens."[@jacobsonConservationInstitution21st2010]  It was first recognized by the United States Supreme Court in the seminal case Martin vs. Waddell's Lessee, 41 U.S. 367 (1842). There, the Court held "that the *public held a common right* to fish in navigable and tidal waters of New Jersey because they and their underlying lands *were owned by the state for the common use by the people*." [@thewildlifesocietyPublicTrustDoctrine2010]  

While Martin v. Waddell’s Lessee may have been the first case, the more signifcant one in U.S. Supreme Court jurisprudence was  Illinois Central Railroad v. Illinois, 146 U.S. 387 (1892). There, the Illinois Legislature had granted an portions of the waterfront and harbor to the Illinois Central Railroad. The conveyance was contested by a subsequent legilsature. The Court held that the public trust doctrine prevented the legislture  from alienating the public right to the lands under navigable waters. [@IllinoisCentralRailroad1892] Professor James L. Sax refers to the case as the "lodestar" in American public trust law. [@saxPublicTrustDoctrine1970]

Since the government under American law is entrusted with the public's assets, it has a responsiblity as trustee and fiduciary to safeguard them for the long term benefit of the public.[@thewildlifesocietyPublicTrustDoctrine2010]


## U.S. Conservation Movement

The 19th and early 20th century ushered in an era of conservation of both habitat and wildlife.  Hailed as the "American Conservation movement", it was extensive and broadly embraced by the public.  The Library of Congress assembled a collection of materials from 1850 to 1920 that, when narrowed to just Congressional and Presidential actions, consisted of "140 Federal statutes and Congressional resolutions, 34 additional legislative documents, excerpts from the Congressional Globe and the Congressional Record [and] 360 Presidential proclamations." For more details on Legislative and Executive Branch action, see the frequency plot at \@ref(fig:plot-law-library-collection) and the full table of bibliographic references with summary at \@ref(fig:library-of-congress-conservation-bib). This paper will address only a couple of the most significant legislative enactments during the U.S. Conservation Movement.  These are relevant to the funding of state-level conservation efforts.

[Library of Congress Evolution of the Conservation Movement 1850-1920](https://memory.loc.gov/ammem/amrvhtml/conshome.html)

Many commentators date the modern U.S. Conservation movement with  the establishment of the first national park.  In 1872, a bill creating Yellowstone National Park was signed into law by President Ulysses S. Grant. American sportsmen were the catalyst for the U.S. conservation movement who saw the waste of wildlife and habitat as a cause for the extinction of some species and sought to preserve others.[@reigerAmericanSportsmenOrigins2000].  Extinction of the passenger pigeon and extirpation of the bison.

The early 1900s and future president of the United States Teddy Rosevelt was a prominent spokesperson and advocate.[@reigerAmericanSportsmenOrigins2000]

The Organic Act of 1916 created the National Park Service and charged them to "promote and regulate . . . the national parks, monuments and reservations" consistent with their purpose "to conserve the scenery and the natural and historic objects and wildlife therein, and to provide for the enjoyment of the same in such manner and by such means as will leave them unimpaired for the enjoyment of future generations."

Finally in 1937, the Pittman–Robertson Federal Aid in Wildlife Restoration Act became law, providing funding for state agencies to carry out  conservation efforts. The Pittman–Robertson Act took over a preëxisting 11% excise tax on firearms and ammunition. Instead of going into the U.S. Treasury as it had done in the past, the money generated by the tax is instead given to the Secretary of the Interior to distribute to the states.The Secretary determines how much to give to each state based on a formula that takes into account both the area of the state and its number of licensed hunters.  The Act is widely credited for restoring the populations of white-tailed deer, wild turkeys and wood ducks. Other animals like American black bears, elk, and cougars have expanded their ranges.

Due to the success of the Pittman–Robertson Act, a similar act was proposed for the protection of fish species, titled his act was titled the Federal Aid in Sports Fish Restoration Act. 

## Decline of Hunting

According to an article in Outdoor Life, hunting reached its peak in 1982 when nearly 17 million hunters purchased 28.3 million licenses. Additionally, persons born between the years 1946 and 1964, commonly referred to as the "Baby Boomers", are the largest cohort of hunters and will age out of the sport in the next 15 years.[@krebsWhyWeSuck2019]  The decline was acknowledged and projected to continue in Wisconsin deer hunters through 2030. [@winklerFutureHuntingAgeperiodcohort2013]

In a 2012 study of Wisconsin deer hunters, researchers projected 10% decline through 2020 and an additional 18% decline from 2020 to 2030. [@winklerFutureHuntingAgeperiodcohort2013]

## State Role in Conservation

Wildlife management is divided between the federal government and individual states. States have primary responsibility as the trustees of wildlife due to the Public Trust Doctrine, except where the Constitution provided for federal oversight.[@beanEvolutionNationalWildlife1997] "Regulated hunting and trapping have been cornerstones of wildlife management in the United States since the advent of wildlife conservation," write two prominent zoologists along these lines."[@bravermanConservationHuntingTill2015]

```{r state-conservation-funding-sources, fig.align="center", warning=FALSE, message=FALSE}
file <- "./data_tidy/2017-01-01-survey-afw-conservation-funding-sources.csv"
dt <- read.csv(file = file, header = F, stringsAsFactors = F)
colnames(dt) <- c("source", "type", "pct")
make.blue <-which(dt$pct %in% c("35%", "15%"))
dt$pct[make.blue] <- cell_spec(dt$pct[make.blue], background = "#d9e1ff")
dt %>%
kbl(caption = "State Fish & Wildlife Conservation Funding by Source", escape = FALSE) %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "float_right"
                ) %>%
  footnote(number = c("Column does not total to 100% due to rounding errors.",
                     "Data from Assoc. of Fish and Wildlife Agencies, Survey.")
          )

```

The Association of Fish and Wildlife Agencies recently surveyed its members from all 50 states.  The effort was undertaken to better understand the scope of state conservation efforts.  Forty-six members participated. The agencies own, manage, leverage, spend or employ

- 464 million acres of land;
- 167 million acres of lakes, reservoirs, wetlands and riparian areas;
- 190,000 volunteers;
- 50,000 total employees;
- 11,000 degreed biologists;
- 10,100 law enforcement officers;
- 6,000 employees with advanced degrees;
- 43,515 vehicles; and
- 5.6 billion dollars in combined budgets

The survey cited as a "major problem" the fact that most citizens do not realize that conservation efforts are primarily shouldered by state fish and wildlife agencies. [@associationoffishwildlifeagenciesStateConservationMachine2017] The table \@ref(tab:state-conservation-funding-sources) at right shows funding by source with hunter licensing fees and Pittman-Robertson funs being the two larges revenue sources.

## Reasons for Decline

Legal hunting enjoys widespread public support in spite of declining participation.  The decline of hunting has less to do with overall public perception and more with changing preferences and demographics within American society.  In a 2019 survey funded by the Association of Fish and Wildlife Agencies, legal hunting continues to enjoy widespread support with 80% of public supporting it.  [@responsemanagementAmericanAttitudesHunting2019] This level of approval has been stable since 1975 when it was first reported at 75%. The approval was greatest when hunting was undertaken for sustenance, safety or wildlife control, but dropped when the activity was undertaken for sport or to obtain trophies.  [@responsemanagementAmericanAttitudesHunting2019] Support was greatest when the respondent was "male, white, living in a rural area, living in the Midwest or Southeast regions, and growing up with firearms."[@responsemanagementAmericanAttitudesHunting2019]

Proferred reasons for the decline include aging of hunting population, increased urbanization, change in consumer preferences . . .

Various explanations for the decline in hunting have been tendered. Researchers found evidence that more people opt for electronic entertainment and urban living as explanations for the decline in hunting. [@robisonWhitherLoveHunting2012]


## Declining Fees and Taxes

"Fish and wildlife conservation funding in the U.S., at least at the state level, typically is characterized as a user-pay, user-benefit model." [@organWildlifeSocietyTechnical2012] "From the earliest days of active management and enforcement by nascent state fish and wildlife agencies, hunters, anglers, and trappers have funded restoration and conservation initiatives."[@organWildlifeSocietyTechnical2012] Conservation efforts are generally financed through two sources: the sale of hunting licenses from the state and the sale of firearms.  Though smaller resources also add to conservation efforts.  To this day, the combination of sportsmen-derived funds from hunting licenses and gun sales comprise between 60 and 90 percent of the typical state fish and wildlife agency budget.[@organWildlifeSocietyTechnical2012] Some wildlife agencies' budgets, however, rely on even higher percentages of revenue from sportsmen.  States, like Texas, fund 97% of its conservation efforts from these two sources.[@bravermanConservationHuntingTill2015]

The primary reliance on hunters as the funding mechanism for conservation is frustrating for many.  "Hunters are key stakeholders; their contributions and integral role in wildlife conservation continue to be important. Maintaining hunter involvement and financial
support of the Institution is necessary, but not sufficient." [@jacobsonConservationInstitution21st2010] Jacobson further states that "[w]e can no longer rely on our most committed constituency to carry the brunt of the financial burden and subsequently be the primary beneficiaries of our actions."[@jacobsonConservationInstitution21st2010]

Conservations efforts require long term, sustainable and dependable funding sources.  [@jacobsonConservationInstitution21st2010] User-based funding is declining and benefits a narrow group of constituents.  "Other funding options states have pursued include dedicated revenues from vehicle license plates, voluntary tax check-offs, and nonprofit foundations to accept financial gifts."[@jacobsonConservationInstitution21st2010]  These fees have been voluntary and negligible in their impact.  Missouri and Virginia were cited as having funding models that were "reliable, consistent and broad-based."  [@jacobsonConservationInstitution21st2010]

### Federal Taxes

-  a 10 percent tax on pistols and revolvers[@26USCS4181];
-  an 11 percent tax on bows, archery equipment,and long arms;
-  an inflation adjusted tax on arrow shafts, standing at 48 cents per shaft in 2014;

"Congress requires each state and U.S. territory to develop a State Wildlife Action Plan - a proactive, comprehensive conservation strategy which examines species health and recommends actions to conserve wildlife and vital habitat before they become more rare and costly to protect."[@allianceforamericasfishwildlifeUsAllianceAmerica: 2]

"A national survey determined that each state needs an average of 26 million in new funding annually ($1.3 billion collectively) to e!ectively implement State Wildlife Action Plans to prevent species from becoming threatened or endangered."[@allianceforamericasfishwildlifeUsAllianceAmerica: 3] 

"Current funding through State and Tribal Wildlife Grant Program funds only reaches a national total of 60 million on average, a shortfall of more than $1.2 billion annually."[@allianceforamericasfishwildlifeUsAllianceAmerica] 

## Recent Federal Developments

"The bipartisan Recovering America's Wildlife Act establishes a 21st century funding model for the proactive conservation of fish and wildlife. The bill will redirect 1.3 billion in existing revenues to state fish and wildlife agencies to implement their science-driven wildlife action plans, and an additional $97.5 million to tribal wildlife managers to conserve species on tribal."[@allianceforamericasfishwildlifeUsAllianceAmerica] 

States would be required to provide at least 25% in nonfederal matching funds. The source of match can be monetary or in-kind contributions originating from state or local governments or private entities such as conservation organizations, universities, businesses, private landowners, or volunteers." [@allianceforamericasfishwildlifeUsAllianceAmerica: 3]

# Data Sources

Data was retrieved from three sources: the U.S. Fish and Wildlife Agency, the U.S. Census Bureau and the National Survey of Fishing, Hunting, & Wildlife-Associated Recreation.

## U.S. Fish and Wildlife


States require a hunting license for those harvesting game.  People who engage in hunting within the boundaries of the state they reside in require a "resident" hunting license whereas those who travel to another state require a "non-resident" license. A proxy for the popularity of the pastime is the number of hunting licenses issued by the states. The U.S. Fish and Wildlife tracks the issuance of hunting, and fishing, licenses.[@usfishwildlifeUSFishWildlife2020] Data is available via their [website](https://www.fws.gov/wsfrprograms/Subpages/LicenseInfo/Hunting.htm). Hunting license information is collected annually from (1) state, (2) territory and (3) insular areas license certifications. The data is available for the years 1958 - 2020, though it is in a pdf format. Variables included:

1. Certified Paid Hunting License Holders--Defined as one individual regardless of the number of licenses purchased.
2. Resident licenses, tags, permits and stamps.
3. Non-resident licenses, tags, permits and stamps.
4. Total hunting licenses, tags, permits and stamps.
5. Gross cost to resident hunters.
6. Gross cost to non-resident hunters.
7. Total gross cost to hunters.

The early years in the dataset did not have values in each of the columns.[@usfishwildlifeUSFishWildlife2020]

## IPUMS Population Data

According to their [website](https://www.nhgis.org/about), "the IPUMS National Historical Geographic Information System (NHGIS) provides free online access to summary statistics and GIS files for U.S. censuses and other nationwide surveys from 1790 through the present." [@mansonIPUMSNationalHistorical2020].  The total population data by state was needed for the years studied so that a per capita computation could be made.[@mansonIPUMSNationalHistorical2020]
NHGIS is one of several IPUMS data integration projects located  with the Minnesota Population Center at the Institute for Social Research & Data Innovation at the University of Minnesota. [@mansonIPUMSNationalHistorical2020]

## National Survey FHWAR

The National Survey of Fishing, Hunting, & Wildlife-Associated Recreation (FHWAR)  reports results from interviews with U.S. residents about their fishing, hunting, and wildlife interaction. The survey has been taken every five years since 1955, predating the U.S. Fish and Wildlife hunting license data by eight years. Originally titled the "National Survey of Fishing and Hunting," it is a valuable resource in identifying hunting trends. [@u.s.departmentoftheinterior2016NationalSurvey2016] The agency describes its survey as "one of the oldest and most comprehensive continuing recreation surveys."[@u.s.departmentoftheinterior2016NationalSurvey2016]  

The interviews were held in two stages: one via telephone of 22,725 to determine who hunted in the household and the second stage was a more in-depth interview of a subset from those identified in first stage.The 2016 survey--the latest available, 3,931 anglers and hunters and 3,997 wildlife watchers were interviewed.[@u.s.departmentoftheinterior2016NationalSurvey2016] The report was explicit that the sample size was large enough for a national conclusion, but the state-level survey was conducted by a private contractor and the results were not included in the report. "The 2016 Survey's questions and methodology were similar to those used in the surveys since 1991 and were comparable.[@u.s.departmentoftheinterior2016NationalSurvey2016]

In spite of the cautionary disclaimers regarding comparisons between the surveys after 1991 to the surveys before 1991, the surveys prior to 1991 are included in this report, although they are designated by a different color.  Table \@ref(tab:fhwar-methodology) showing the numerators and denominators for the calculation of the participation rate is included below. Note how the age groups change over time and the all-time high for hunters was 1975 when hunters as young as 9 were included.

```{r fhwar-methodology, warning = F, message=F, fig.align="center",}

library(kableExtra)
file <- "./data_pure/usfw/2020-11-20-fw_nat_survey_fhwar_1955_2016.csv"
dt <- read.csv(file = file, header = T, stringsAsFactors = F)
numeric.cols <- c(3, 5)
dt[, numeric.cols] <- apply(dt[, numeric.cols], 2, prettyNum, big.mark=",", scientific=FALSE)
pct.cols <- 7
dt[, pct.cols] <- paste0(round(dt[, pct.cols] * 100, 2), "%")
colnames(dt) <- c("year", 
                  "method", 
                  "tot_hunters", 
                  "age_group_hunters", 
                  "tot_pop", 
                  "age_group_pop", 
                  "part_rate"
                  )
dt[5, 3] <- cell_spec(dt[5, 3],  background = "#d9e1ff")
dt %>%
kbl(caption = "Computation of FHWAR Participation Rate\n 1955 - 2016",
    escape = FALSE) %>%
  kable_styling(bootstrap_options = "striped", full_width = T) %>%
  footnote(general = "Column does not total to 100% due to rounding errors.")
```





# Analysis

## General

The analysis relied upon the statistical programming language known as `R`. [@rcoreteamProjectStatisticalComputing2020] The plots were graphed with `ggplot2`.[@wickhamGgplot2ElegantGraphics2016] The data from the sources above were combined into a single, wide dataframe and then converted into long format.  The total number of observations in the dataframe was `r nrow(df.00)` and the number of variables or columns was `r ncol(df.00)`. The column names "key" and "value" are the default labels in the `tidyr` package. [@wickhamTidyrTidyMessy2020] Consistent with good data practice, each row is an observation and each column is a variable.  [@wickhamTidyData2014] The top 5 rows of the dataframe are shown below for illustrative purposes.

```{r head-dataframe, echo=FALSE}
df.table <- head(df.00)
# knitr::kable(df.table, caption = "Top 5 Rows of Dataframe", format.args = list(big.mark = ","))
df.table$value <- prettyNum(df.table$value, big.mark=",", scientific=FALSE)

kbl(df.table, caption = "Top 5 Rows of Hunting License Dataframe") %>%
  kable_styling(bootstrap_options = "striped", full_width = T)
```

The variables that were assembled into the dataframe are as follows:

```{r variable-listing-table, echo=FALSE}
t1 <- table(df.00$key, df.00$year)
kbl(t1, caption = "Variable Frequency by Year") %>%
      kable_styling(bootstrap_options = "striped", full_width = T)

```

Not all variables were carried forward through the period of `r min(df.00$year)` to `r max(df.00$year)`.  For example, the 1960 data from USFW omitted five of the possible six variables which were filled with `NA`.  Only observations with  values were retained while `NA` values were omitted. This is also known as "complete cases" strategy and is a traditional approach to dealing with missing values.  [@grahamMethodsHandlingMissing2012] The District of Columbia and Puerto Rico, as well as U.S. territories, were also omitted.  Thus, the "50" seen frequently in the table above represent the 50 U.S. states.

## National

Diam volutpat commodo sed egestas. Ac turpis egestas integer eget aliquet nibh. Ultricies mi quis hendrerit dolor. Netus et malesuada fames ac turpis egestas integer eget aliquet. Cras semper auctor neque vitae tempus quam pellentesque nec nam. Morbi tincidunt ornare massa eget egestas purus viverra. Dignissim cras tincidunt lobortis feugiat vivamus at. Gravida rutrum quisque non tellus orci ac. Ornare suspendisse sed nisi lacus sed viverra tellus in hac. Viverra accumsan in nisl nisi scelerisque. Egestas erat imperdiet sed euismod. Netus et malesuada fames ac turpis. Proin libero nunc consequat interdum varius sit amet mattis vulputate. In nibh mauris cursus mattis molestie a iaculis at. Enim facilisis gravida neque convallis a cras semper. Tellus orci ac auctor augue mauris augue neque gravida. Feugiat vivamus at augue eget arcu dictum varius. Potenti nullam ac tortor vitae purus faucibus. 

Diam volutpat commodo sed egestas. Ac turpis egestas integer eget aliquet nibh. Ultricies mi quis hendrerit dolor. Netus et malesuada fames ac turpis egestas integer eget aliquet. Cras semper auctor neque vitae tempus quam pellentesque nec nam. Morbi tincidunt ornare massa eget egestas purus viverra. Dignissim cras tincidunt lobortis feugiat vivamus at. See \@ref(fig:total-hunters-licenses). Gravida rutrum quisque non tellus orci ac. Ornare suspendisse sed nisi lacus sed viverra tellus in hac. Viverra accumsan in nisl nisi scelerisque. Egestas erat imperdiet sed euismod. Netus et malesuada fames ac turpis. Proin libero nunc consequat interdum varius sit amet mattis vulputate. In nibh mauris cursus mattis molestie a iaculis at. Enim facilisis gravida neque convallis a cras semper. Tellus orci ac auctor augue mauris augue neque gravida. Feugiat vivamus at augue eget arcu dictum varius. Potenti nullam ac tortor vitae purus faucibus. 

```{r total-hunters-licenses, out.width='65%', fig.cap='Figure shows the total number of hunting licenses or answering in the affirmative on the Survey of FHWAR. The blue line is from state submitted hunting license data.  The pink and yellow series are from the Survey of FHWAR, but authors warn of using outcomes from the survey prior to 1991 because of a change in methodology', fig.align='center', echo=FALSE}
plot_total_hunting_licenses <- function(){
        #Add main dataframe
        file <- "./data_tidy/hunting_licenses_by_state_1960_and_2020.csv"
        colClasses <- c(rep("character", 3), "integer", "character", "numeric")
        df.00 <- data.table::fread(file = file, data.table = F, colClasses = colClasses)
        df.01 <- dplyr::filter(df.00, key == "certified_paid_hunting_license_holders")
        df.02 <-        df.01 %>%
                        group_by(year) %>%
                        summarize(total_licenses = sum(value))
        df.03 <- tidyr::gather(df.02, key = key, value = value, -year)
        df.03$key <- "tot_hunters_licenses"
        # Add FHWAR line plot
        file <-  "./data_pure/usfw/2020-11-20-fw_nat_survey_fhwar_1955_2016.csv"
        colClasses <- c("integer", "character", "integer", "character", "integer", "character", "numeric")
        df.fhwar <- read.csv(file = file, header = T, colClasses = colClasses)
        df.fhwar <- select(df.fhwar, year, total_all_hunters)
        df.fhwar <- tidyr::gather(df.fhwar, key = key, value = value, -year)
        df.fhwar$key[which(df.fhwar$year %in% 1955:1990)] <- "tot_hunters_pre_1991"
        df.fhwar$key[which(df.fhwar$year %in% 1990:2020)] <- "tot_hunters_post_1991"
        #rbind
        df.04 <- rbind(df.03, df.fhwar)
        df.04$key <- factor(df.04$key, levels = c("tot_hunters_licenses",
                                                     "tot_hunters_pre_1991",
                                                     "tot_hunters_post_1991")
                               )
        #plot total number of hunting licenses
        p <- ggplot(df.04, aes(year, value, group = key, colour = key))
        p <- p + geom_line()
        p <- p + geom_point()
        p <- p + scale_y_continuous(limits = c(0, 22000000),
                                    name = "",
                                    breaks = c(0, 50e5, 100e5, 150e5, 200e5),
                                    labels = c("0", "5m", "10m", "15m", "20m")
        )
        p <- p + scale_x_continuous(name = "")
        p <- p + scale_colour_manual(values = c("#4582ec", "#ffa600", "#ff5ca4"))
        p <- p + ggtitle("Total U.S. Hunters from License and Surveys \n1955 - 2020")
        p <- p + theme_gdocs()
        filename <- "./figs/total_us_hunters_from_license_and_survey_data_1955_2020.jpg"
        ggsave(p, filename = filename, height = 5, width = 8, dpi = 300, units = "in")
        p
}
plot_total_hunting_licenses()
```
Diam volutpat commodo sed egestas. Ac turpis egestas integer eget aliquet nibh. Ultricies mi quis hendrerit dolor. Netus et malesuada fames ac turpis egestas integer eget aliquet. Cras semper auctor neque vitae tempus quam pellentesque nec nam. Morbi tincidunt ornare massa eget egestas purus viverra. Dignissim cras tincidunt lobortis feugiat vivamus at. Gravida rutrum quisque non tellus orci ac. Ornare suspendisse sed nisi lacus sed viverra tellus in hac. Viverra accumsan in nisl nisi scelerisque. Egestas erat imperdiet sed euismod. Netus et malesuada fames ac turpis. Proin libero nunc consequat interdum varius sit amet mattis vulputate. In nibh mauris cursus mattis molestie a iaculis at. Enim facilisis gravida neque convallis a cras semper. Tellus orci ac auctor augue mauris augue neque gravida. Feugiat vivamus at augue eget arcu dictum varius. Potenti nullam ac tortor vitae purus faucibus. See \@ref(fig:plot-pct-hunters-1).

```{r plot-pct-hunters-1, out.width='65%', fig.cap='Figure shows the percentage of the population that engages in hunting. The blue line is from state submitted hunting license data.  The pink and yellow series are from the Survey of FHWAR, but authors warn of using outcomes from the survey prior to 1991 because of a change in methodology', fig.align='center', echo=FALSE}

plot_pct_hunters_from_FHWAR_and_hunters_licenses <- function(){
        calculate_pct_hunting_licenses <- function(){
        #Add main dataframe
        file <- "./data_tidy/hunting_licenses_by_state_1960_and_2020.csv"
        colClasses <- c(rep("character", 3), "integer", "character", "numeric")
        df.00 <- data.table::fread(file = file, data.table = F, colClasses = colClasses)
        #total up the number of hunting licenses
        df.01 <- dplyr::filter(df.00, key == "certified_paid_hunting_license_holders")
        df.02 <-        df.01 %>%
                group_by(year) %>%
                summarize(total_licenses = sum(value))
        #total up the pop among the states
        df.03 <- dplyr::filter(df.00, key == "pop")
        df.04 <- df.03 %>%
                group_by(year) %>%
                summarize(tot_pop = sum(value))
        #figure out a per capita on the totals
        df.04$pct_hunting_licenses <- round((df.02$total_licenses / df.04$tot_pop) * 100, 2)
        df.04 <- df.04[, c(1,3)]
        df.04 <- tidyr::gather(df.04, key = key, value = value, -year)
        df.04
}
        calculate_pct_hunters_from_survey <- function(){
                # Add FHWAR line plot
                file <-  "./data_pure/usfw/2020-11-20-fw_nat_survey_fhwar_1955_2016.csv"
                colClasses <- c("integer", "character", "integer", "character", "integer", "character", "numeric")
                df.fhwar <- read.csv(file = file, header = T, colClasses = colClasses)
                df.fhwar <- select(df.fhwar, year, "participation_rate_calculated")
                df.fhwar$participation_rate_calculated <- round(df.fhwar$participation_rate_calculated *100, 2)
                df.fhwar <- tidyr::gather(df.fhwar, key = key, value = value, -year)
                df.fhwar$key[which(df.fhwar$year %in% 1955:1990)] <- "part_rate_pre_1991"
                df.fhwar$key[which(df.fhwar$year %in% 1990:2020)] <- "part_rate_post_1991"
                df.fhwar
        }
        df <- rbind(calculate_pct_hunters_from_survey(), calculate_pct_hunting_licenses())
        df$key <- factor(df$key, levels = c("pct_hunting_licenses", "part_rate_pre_1991", "part_rate_post_1991"))
        
        p <- ggplot(df, aes(year, value, group = key, colour = key))
        p <- p + geom_line()#4582EC
        p <- p + geom_point(size = 3)
        p <- p + scale_y_continuous(limits = c(0, 12),
                                    name = "",
                                    breaks = c(0, 3.0, 6.0, 9.0, 12),
                                    labels = c("0.0%", "3.0%", "6.0%", "9.0%", "12.0%")
        )
        p <- p + scale_x_continuous(name = "")
        p <- p + scale_colour_manual(values = c("#4582ec", "#ffa600", "#ff5ca4"))
        p <- p + ggtitle("Hunting Licenses vs. Survey Participation Rate")
        p <- p + theme_gdocs()
        filename <- "./figs/hunting_licenses_vs_survey_part_rate_1955_2020.jpg"
        ggsave(p, filename = filename, height = 5, width = 8, dpi = 300, units = "in")
        p
}
plot_pct_hunters_from_FHWAR_and_hunters_licenses()
```

Aenean vel elit scelerisque mauris pellentesque pulvinar. Non pulvinar neque laoreet suspendisse interdum consectetur libero id faucibus. Adipiscing vitae proin sagittis nisl rhoncus mattis. Mi bibendum neque egestas congue quisque egestas diam in. Vel pretium lectus quam id leo in vitae turpis massa. Cursus in hac habitasse platea. Faucibus pulvinar elementum integer enim neque volutpat ac. Sed blandit libero volutpat sed cras ornare arcu dui. In ornare quam viverra orci. Libero justo laoreet sit amet cursus sit amet. See \@ref(fig:hunting-population-increase).

```{r hunting-population-increase, fig.cap='Figure shows that the declining percentage of hunters is due to rising population while hunting license issuance has remained the same.', out.width='65%', fig.align='center', echo=F}
plot_change_in_hunters_license_to_population <- function(){
        file <- "./data_pure/total_annual_hl_and_pop_1960-2020.csv"
        colClasses <- c("integer", "integer", "integer", "numeric", "numeric")
        df.pct <- read.csv(file = file, header = T, colClasses = colClasses)
        df.pct <- tidyr::gather(df.pct, key = key, value = value, -year)
        df.pct <- dplyr::filter(df.pct, key == "pct_increase_population" | key == "pct_increase_hunting_lic")
        p <- ggplot(df.pct, aes(year, value, group = key, color = key))
        p <- p + geom_line()
        p <- p + geom_point(size = 3)
        p <- p + scale_color_manual(values=c("#4582EC", "#ffa600"))
        p <- p + theme_gdocs()
        p <- p + scale_x_continuous(name = "")
        p <- p + ggtitle("Pct. Increase in Population and Hunting Licenses \nbase year = 1960")
        filename <- "./figs/pct_increase_in_population_and_hunting_licenses_1960_to_2020.jpg"
        ggsave(p, filename = filename, height = 5, width = 8, dpi = 300, unit = "in")
        p
}
plot_change_in_hunters_license_to_population()
```

Aenean vel elit scelerisque mauris pellentesque pulvinar. Non pulvinar neque laoreet suspendisse interdum consectetur libero id faucibus. Adipiscing vitae proin sagittis nisl rhoncus mattis. Mi bibendum neque egestas congue quisque egestas diam in. Vel pretium lectus quam id leo in vitae turpis massa. Cursus in hac habitasse platea. Faucibus pulvinar elementum integer enim neque volutpat ac. Sed blandit libero volutpat sed cras ornare arcu dui. In ornare quam viverra orci. Libero justo laoreet sit amet cursus sit amet. See \@ref(fig:figures-side-by-side).

```{r figures-side-by-side, fig.show="hold", out.width="50%", message=FALSE, warning=FALSE, fig.cap='Gross cost per hunter and per person compared to inflation. Notice the y-axis showing that the per person cost is less than $3.00'}
plot_cost_per_hunter_idx_for_inflation <- function(){
        library(ggthemes)
        create_df_cost_per_hunter <- function(){
                #Add main dataframe
                file <- "./data_tidy/hunting_licenses_by_state_1960_and_2020.csv"
                colClasses <- c(rep("character", 3), "integer", "character", "numeric")
                df.00 <- data.table::fread(file = file, data.table = F, colClasses = colClasses)
                #total cost to hunters
                df.01 <- dplyr::filter(df.00, key == "total_gross_cost_to_hunters")
                df.02 <-df.01 %>%
                        group_by(year) %>%
                        summarize(total_cost = sum(value))
                #total hunters by year
                df.03 <- dplyr::filter(df.00, key == "certified_paid_hunting_license_holders")
                df.04 <- df.03 %>%
                        group_by(year) %>%
                        summarize(total_hunters = sum(value))
                #merge
                df.05 <- dplyr::left_join(df.02, df.04)
                #total cost per hunter
                df.05$cost_per_hunter <- df.05$total_cost / df.05$total_hunters
                df.05 <- dplyr::select(df.05, year, cost_per_hunter)
                df.06 <- tidyr::gather(df.05, key = key, value = value, -year)
                #total cost per person
                df.07 <- dplyr::filter(df.00, key == "pop")
                df.08 <- df.07 %>%
                        group_by(year) %>%
                        summarize(total_pop = sum(value))
                df.09 <- merge(df.02, df.08)
                df.09$cost_per_person <- df.09$total_cost / df.09$total_pop
                df.09 <- dplyr::select(df.09, year, cost_per_person)
                df.09 <- tidyr::gather(df.09, key = key, value = value, -year)
                #join cost_per_hunter to cost_per_person
                df.10 <- rbind(df.06, df.09)
                df.10
        }
        create_df_for_infl_idx <- function(){
                #build inflation adjusted series for comparison
                source("./R/functions.R")
                df.infl <- data.frame(total_cost_1970 = 101608879,
                                      const_dol_2020 = convert_to_constant_dollars(price = 1010608879, from_date = 1970, to_date = 2019),
                                      total_hunt_1970 = 15658318,
                                      total_hunt_2020 = 15151724,
                                      total_pop_1970 = 202455416,
                                      total_pop_2020 = 331794992,
                                      infl_adj_cost_per_hunter_1970 = 101608879 / 15658318,
                                      infl_adj_cost_per_hunter_2020 = 681900329.51 / 15151724,
                                      infl_adj_cost_per_person_1970 = 101608879 / 202455416,
                                      infl_adj_cost_per_person_2020 = 681900329.51 / 331794992
                )
                df.infl <- tidyr::gather(df.infl, key = key, value = value)
                df.infl$year <- stringr::str_sub(df.infl$key, -4)
                df.infl$year <- as.integer(df.infl$year)       
                df.infl$key  <-gsub("_1970|_2020", "", df.infl$key)
                df.infl <- df.infl[grep("infl_adj", df.infl$key), ]
                df.infl
        }
        create_plot_for_hunters <- function(){
                df.10 <- create_df_cost_per_hunter()
                df.infl <- create_df_for_infl_idx()
                #plot
                library(ggthemes)
                p <- ggplot(dplyr::filter(df.10, key == "cost_per_hunter"), aes(year, value, group = key, colour = key))
                p <- p + geom_line()
                p <- p + geom_point(size = 3)
                p <- p + scale_y_continuous(name = "",
                                            limits = c(0, 60),
                                            breaks = c(0, 15, 30, 45, 60),
                                            labels = c("$0", "$15", "$30", "$45", "$60")
                )
                p <- p + scale_color_manual(values=c("#4582EC", "#00d0ff"))
                df.infl.1 <- dplyr::filter(df.infl, key == "infl_adj_cost_per_hunter")
                df.infl.1$key <- gsub("_per_hunter", "", df.infl.1$key)
                p <- p + geom_line(data = df.infl.1, aes(year, value, group = key, colour = key))
                p <- p + geom_point(data = df.infl.1, aes(year, value, group = key, colour = key), size = 3)
                p <- p + theme_gdocs()
                p <- p + scale_x_continuous(name = "", 
                                            limits = c(1960, 2020))
                p <- p + ggtitle("Gross Cost Per Hunter Indexed to Inflation \n1970-2020")
                filename <- "./figs/gross_cost_per_hunter_indexed_to_inflation_1970_2020.jpg"
                ggsave(p, filename = filename, height = 5, width = 8, dpi = 300, units = "in")
                p
        }
        create_plot_for_hunters()
}
p1 <- plot_cost_per_hunter_idx_for_inflation()
p1
plot_cost_per_person_idx_for_inflation <- function(){
        library(ggthemes)
        create_df_cost_per_hunter <- function(){
        #Add main dataframe
        file <- "./data_tidy/hunting_licenses_by_state_1960_and_2020.csv"
        colClasses <- c(rep("character", 3), "integer", "character", "numeric")
        df.00 <- data.table::fread(file = file, data.table = F, colClasses = colClasses)
        #total cost to hunters
        df.01 <- dplyr::filter(df.00, key == "total_gross_cost_to_hunters")
        df.02 <-df.01 %>%
                group_by(year) %>%
                summarize(total_cost = sum(value))
        #total hunters by year
        df.03 <- dplyr::filter(df.00, key == "certified_paid_hunting_license_holders")
        df.04 <- df.03 %>%
                group_by(year) %>%
                summarize(total_hunters = sum(value))
        #merge
        df.05 <- dplyr::left_join(df.02, df.04)
        #total cost per hunter
        df.05$cost_per_hunter <- df.05$total_cost / df.05$total_hunters
        df.05 <- dplyr::select(df.05, year, cost_per_hunter)
        df.06 <- tidyr::gather(df.05, key = key, value = value, -year)
        #total cost per person
        df.07 <- dplyr::filter(df.00, key == "pop")
        df.08 <- df.07 %>%
                group_by(year) %>%
                summarize(total_pop = sum(value))
        df.09 <- merge(df.02, df.08)
        df.09$cost_per_person <- df.09$total_cost / df.09$total_pop
        df.09 <- dplyr::select(df.09, year, cost_per_person)
        df.09 <- tidyr::gather(df.09, key = key, value = value, -year)
        #join cost_per_hunter to cost_per_person
        df.10 <- rbind(df.06, df.09)
        df.10
}
        create_df_for_infl_idx <- function(){
        #build inflation adjusted series for comparison
        source("./R/functions.R")
        df.infl <- data.frame(total_cost_1970 = 101608879,
                              const_dol_2020 = convert_to_constant_dollars(price = 1010608879, from_date = 1970, to_date = 2019),
                              total_hunt_1970 = 15658318,
                              total_hunt_2020 = 15151724,
                              total_pop_1970 = 202455416,
                              total_pop_2020 = 331794992,
                              infl_adj_cost_per_hunter_1970 = 101608879 / 15658318,
                              infl_adj_cost_per_hunter_2020 = 681900329.51 / 15151724,
                              infl_adj_cost_per_person_1970 = 101608879 / 202455416,
                              infl_adj_cost_per_person_2020 = 681900329.51 / 331794992
        )
        df.infl <- tidyr::gather(df.infl, key = key, value = value)
        df.infl$year <- stringr::str_sub(df.infl$key, -4)
        df.infl$year <- as.integer(df.infl$year)       
        df.infl$key  <-gsub("_1970|_2020", "", df.infl$key)
        df.infl <- df.infl[grep("infl_adj", df.infl$key), ]
        df.infl
}
        create_plot_for_person <- function(){
                df.10 <- create_df_cost_per_hunter()
                df.infl <- create_df_for_infl_idx()
                p <- ggplot(dplyr::filter(df.10, key == "cost_per_person"), aes(year, value, group = key, colour = key))
                p <- p + geom_line()
                p <- p + geom_point(size = 3)
                p
                p <- p + scale_y_continuous(name = "",
                                            limits = c(0, 3),
                                            breaks = c(0, .75, 1.50, 2.25, 3),
                                            labels = c("$0.0", "$0.75", "$1.50", "$2.25", "$3.00")
                )
                p <- p + scale_color_manual(values=c("#ffa600", "#ffdc00"))
                df.infl.2 <- dplyr::filter(df.infl, key == "infl_adj_cost_per_person")
                df.infl.2$key <- gsub("_per_person", "", df.infl.2$key)
                p <- p + geom_line(data = df.infl.2, aes(year, value, group = key, colour = key))
                p <- p + geom_point(data = df.infl.2, aes(year, value, group = key, colour = key), size = 3)
                p <- p + theme_gdocs()
                p <- p + scale_x_continuous(name = "", 
                                            limits = c(1960, 2020))
                p <- p + ggtitle("Gross Cost Per Person Indexed to Inflation\n1970-2020")
                filename <- "./figs/gross_cost_per_person_indexed_to_inflation_1970_2020.jpg"
                ggsave(p, filename = filename, height = 5, width = 8, dpi = 300, units = "in")
                p
        }
        create_plot_for_person()
}
p2 <- plot_cost_per_person_idx_for_inflation()
p2
#
```
Aenean vel elit scelerisque mauris pellentesque pulvinar. Non pulvinar neque laoreet suspendisse interdum consectetur libero id faucibus. Adipiscing vitae proin sagittis nisl rhoncus mattis. Mi bibendum neque egestas congue quisque egestas diam in. Vel pretium lectus quam id leo in vitae turpis massa. Cursus in hac habitasse platea. Faucibus pulvinar elementum integer enim neque volutpat ac. Sed blandit libero volutpat sed cras ornare arcu dui. In ornare quam viverra orci. Libero justo laoreet sit amet cursus sit amet. See \@ref(fig:hunting-population-increase).
## State-level


```{r table_00, echo=FALSE}
df.01 <- dplyr::filter(df.00, year == 2020 & key == "per_capita_hunting_license")
df.01$value <- round(df.01$value * 1000, 0)
df.01 <- dplyr::arrange(df.01, -value)
df.01$rank <- 1:nrow(df.01)
t1 <- df.01[1:10, ]
t1 <- dplyr::select(t1, rank, state, value)
colnames(t1)[3] <- "licenses/1000"
t2 <- df.01[41:50, ]
t2 <- dplyr::select(t2, rank, state, value)
colnames(t2)[3] <- "licenses/1000"
row.names(t2) <- NULL
#knitr::kable(t2, caption = "Bottom 10 States for Hunting")
#knitr::kable(list(t1, t2), caption = "Top & Bottom 10 States for Hunting")
kable(t1, caption = "Top 10 States for Hunting") %>%
  kable_styling(bootstrap_options = "striped", full_width = FALSE, position = "float_left")
kable(t2, caption = "Bottom 10 States for Hunting") %>%
  kable_styling(bootstrap_options = c("striped"), full_width = FALSE, position = "left")


```

```{r plot-state-deciles, echo=FALSE}
# spaghetti plot compare top 10 states for %growth/decrease in pchunting #license
df.01 <- dplyr::filter(df.00, key == "per_capita_hunting_license")
df.02 <- dplyr::filter(df.01, year %in% c(1960, 2020))
df.03 <- tidyr::spread(df.02, key = year, value = value)
df.03$pct <- ((df.03$'2020' - df.03$'1960') / df.03$'1960' ) * 100
df.03$state_quintile <- ggplot2::cut_number(df.03$pct, n = 5, labels = paste("Q", 1:5, sep = ""))
df.04 <- dplyr::filter(df.03, state_quintile %in% c("Q1", "Q5"))
df.05 <- dplyr::select(df.04, fips:abb, state_quintile, pct, '1960', '2020')
df.06 <- tidyr::gather(df.05, key = year, value = value,
                       -fips, -state, -abb, -state_quintile, -pct)
df.06$value <- round((df.06$value * 1000), 0)
df.06$year <- as.integer(df.06$year)
#plot
p <- ggplot(df.06, aes(year, value,  group = state, colour = state_quintile))
p <- p + geom_line()
p <- p + geom_point(size = 3)
p <- p + theme_gdocs()
p <- p + scale_x_continuous(name = "")
p <- p + ggtitle("U.S. States Quintiles Compared \nchange in Per Capita Hunting License")
p <- p + scale_color_manual(values=c("#4582EC", "#ffa600"))
p
```

```{r table-pct-increase,echo=FALSE}
# bottom 10
 df.07 <- dplyr::filter(df.06, state_quintile == "Q1" & year == 2020)
 df.08 <- dplyr::arrange(df.07, -pct)
 colnames(df.08)[5] <- "percent_change"
 df.08$percent_change <- round(df.08$percent_change, 1)
 df.08$percent_change <- paste(df.08$percent_change, "%", sep = "")
 df.08$rank <- 41:50
 df.09 <- dplyr::select(df.08, rank, state, percent_change)
# top 10
 df.10 <-dplyr::filter(df.06, state_quintile == "Q5" & year == 2020)
 df.11 <- dplyr::arrange(df.10, -pct)
 colnames(df.11)[5] <- "percent_change"
 df.11$percent_change <- round(df.11$percent_change, 1)
 df.11$percent_change <- paste(df.11$percent_change, "%", sep = "")
 df.11$rank <- 1:10
 df.12 <- dplyr::select(df.11, rank, state, percent_change)
 #add table
  t1 <- df.12
 t2 <- df.09

 kable(t1, caption = "Top 10 States %Change in Hunters") %>%
   kable_styling(bootstrap_options = "striped", full_width = FALSE, position = "float_left")
 kable(t2, caption = "Bottom 10 States %Change in Hunters") %>%
   kable_styling(bootstrap_options = c("striped"), full_width = FALSE, position = "left")

```

```{r choroplth-map-pct-change-hunters, echo=FALSE, fig.align="center", out.width='90%'}

knitr::include_graphics( "./figs/us-avg-annual-pct-change-per-capita-hunter-1960-2020.jpg")

```

## Further Research

2014 Allocation of gun revenue plotted compared to hunter license data.  A floor and ceiling is set within the allocation forumula as well as territorial size.




# Conclusions

Hunting license issuance among the states for the 1960 to 2020 years declined.  This conclusion matches other studies and other datasets.  Possible explanations in the decline in hunting include the aging of the U.S. population, the continued migration from rural to urban settings.[@mehmoodFactorsAssociatedDeclining2003]Hunting as a pastime remains grim, imperiling state conservation efforts.  Wildlife and habitat conservation efforts will depend on the US moving away from a "pay-to-play" model and toward more sustainable funding streams like that proposed in the Act.

# Bibliography

<div id="refs"></div>

# Appendix

## Annual Wildlife Restoration Apportionment

```{r facet-plot-wr-allocation, echo=FALSE, out.width="100%"}

knitr::include_graphics("./figs/annual_wildlife_restoration_funding_by_state_1939_2020.jpg")

```

## Directory of Fish & Wildlife Associations

[Directory of state F&W offices](https://www.fws.gov/info/pocketguide/sfwacontacts.html)
[State and Territorial Fish and Wildlife Offices](https://www.fws.gov/offices/statelinks.html)

## Federal Action in Conservation 1850 - 1920

The Library of Congress compiled a wide ranging collection of materials documenting the conservation movement. The collection, entitled "The Evolution of the Conservation Era 1850 to 1920", can be found on its [website](http://memory.loc.gov/ammem/amrvhtml/conshome.html). The Law Library of the Library of Congress contributed 555 separate documents for the collection.  Those materials are referenced here and serve as the basis for both the plot and the table below.  

```{r plot-law-library-collection, fig.cap="Plot shows that the vast majority of federal legislation occurred [in](https://google.com) the twenty years between 1900 and 1920.", fig.align="center", out.width="65%", fig.topcaption = TRUE, warning=FALSE, message=FALSE}

plot_library_of_congress_bib_by_date_and_type <- function(){
library(ggthemes)
file <- "./data_tidy/loc_bibliography_conservation.csv"
df <- read.csv(file =  file, header = T, stringsAsFactors = F)
df.01 <- dplyr::select(df, date, action, amt)
df.01$date <- as.Date(df.01$date, format = "%Y-%m-%d")
df.01$action[grep("Senate", df.01$action)] <- "Senate Document"
df.02 <-    df.01 %>%
      mutate(year = format(date, "%Y")) %>%
      group_by(year, action) %>%
      summarise(total = sum(amt)) %>%
      arrange(year, total)
df.02$year <- as.Date(df.02$year, format = "%Y")
df.02$action <- factor(df.02$action, levels = c("Senate Document", "House Report", "Debates and Proceedings", 
                                            "Joint Resolution", "Law Passed", "Proclamation")
)
# set levels to: dput(dimnames(sort(table(df.01$action)))[[1]]) Ha!
#plot
p <- ggplot(df.02, aes(fill=action, y=total, x=year))
p <- p + geom_bar(position="stack", stat="identity")
p <- p + scale_x_date(name = "",
                      limits = as.Date(c("1860", "1921"), format = "%Y"),
                      breaks = as.Date(c("1860", "1880", "1900", "1920"), format = "%Y"),
                      #date_breaks = "10 years",
                      date_labels = "%Y"
)
# p <- p + scale_fill_manual(values = c("#f860bd", "#ff6088", "#ff7d4e", "#b473e2", "#ffa600", "#4582ec")
# )
p <- p + scale_fill_manual(values = c('#4daf4a','#984ea3','#ff7f00','#ffff33','#e41a1c','#377eb8'))
p <- p + scale_y_continuous(name = "")
p <- p + ggtitle("U.S. Government Action in  Conservation\n1860 - 1920")
p <- p + theme_gdocs()
filename <- "./figs/us_government_action_in_conservation_1860_1920.jpg"
ggsave(p, filename = filename, height = 5, width = 8, unit = "in")
p
}
plot_library_of_congress_bib_by_date_and_type()

```


```{r library-of-congress-conservation-bib, fig.topcaption=TRUE, fig.cap="Table of U.S. Legislative and Executive Branch Actions in conservation from 1850 to 1920.",  warning=FALSE, message=FALSE}

#install.packages('webshot')
library('webshot')
webshot::install_phantomjs()
df <- read.csv(file = "./data_tidy//loc_bibliography_conservation.csv",
               header = T,
               stringsAsFactors = F)
df.01 <- dplyr::select(df, date, cite, action, summary_1)
colnames(df.01) <- gsub("_1", "", colnames(df.01))
DT::datatable(df.01, escape = FALSE, 
              style = 'bootstrap', 
              class = "table table-striped compact", rownames = FALSE,
              caption = "Table of U.S. Legislative and Executive Branch Actions in conservation from 1850 to 1920"
              )

```

